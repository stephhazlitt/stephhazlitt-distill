[
  {
    "path": "posts/2019-02-26-wind-direction/",
    "title": "When You Miss the Target üéØ",
    "description": "A number of people suggested I look at wind direction üí® to explain my fence drama. So I did.",
    "author": [],
    "date": "2019-02-26",
    "categories": [],
    "contents": "\n\nSometimes you can do a data analysis and not find anything that really sparks joy‚Äîno correlations, no explanatory patterns üìä\nSometimes you can do a data analysis and be looking at the wrong data üîç\nSometimes nice people make suggestions where you might want to look üëÄ\nIn my short post looking at whether average wind speeds (km/h) during the Victoria, British Columbia February 2019 storm might have explained why my fence fell down, I didn‚Äôt find a ‚Äúsmoking gun‚Äù üî´‚Äîthe February storm perhaps lasted longer than ‚Äòusual‚Äô but measured wind speeds were within the normal range of storm wind speeds since 1994.\nA number of people suggested I look at wind direction üí®. So I did. KAPOW üéâüòÆ\nGet and wrangle the Environment and Climate Change Canada (ECCC) wind direction data using the the rOpenSci weathercan R package üì¶. I filtered out wind speeds of zero and grouped wind speed into a three categories (1-25 km/h, 26-50 km/h and 51-75 km/h):\nlibrary(weathercan)\nlibrary(dplyr)\nlibrary(ggplot2)\n\nstn <- stations_search(name = \"Esquimalt\", interval = \"hour\") %>% \n  select(station_id) %>% \n  pull()\n\ndata <- weather_dl(station_id = stn)\n\nwind_dir <- data %>% \n  select(station_id, station_name, date, wind_spd, wind_dir) %>% \n  filter(wind_spd != 0) %>% \n  mutate(wind_spd_cat = cut(wind_spd, breaks = c(0,25,50,75),\n                            labels = c(\"1-25 km/h Winds\",\n                                       \"26-50 km/h Winds\",\n                                       \"51-75 km/h Winds\")))\nwind_dir\n## # A tibble: 211,018 x 6\n##    station_id station_name      date       wind_spd wind_dir wind_spd_cat  \n##    <chr>      <chr>             <date>        <dbl>    <dbl> <fct>         \n##  1 52         ESQUIMALT HARBOUR 1994-02-01       11       36 1-25 km/h Win‚Ä¶\n##  2 52         ESQUIMALT HARBOUR 1994-02-01       11       35 1-25 km/h Win‚Ä¶\n##  3 52         ESQUIMALT HARBOUR 1994-02-01       15       35 1-25 km/h Win‚Ä¶\n##  4 52         ESQUIMALT HARBOUR 1994-02-01        9       36 1-25 km/h Win‚Ä¶\n##  5 52         ESQUIMALT HARBOUR 1994-02-01        7       36 1-25 km/h Win‚Ä¶\n##  6 52         ESQUIMALT HARBOUR 1994-02-01        9       36 1-25 km/h Win‚Ä¶\n##  7 52         ESQUIMALT HARBOUR 1994-02-01       11       36 1-25 km/h Win‚Ä¶\n##  8 52         ESQUIMALT HARBOUR 1994-02-01        7       36 1-25 km/h Win‚Ä¶\n##  9 52         ESQUIMALT HARBOUR 1994-02-01        9       35 1-25 km/h Win‚Ä¶\n## 10 52         ESQUIMALT HARBOUR 1994-02-01        9       36 1-25 km/h Win‚Ä¶\n## # ‚Ä¶ with 211,008 more rows\nPlot wind direction over time for each wind speed category:\n\n  wind_plot <- wind_dir %>% \n  filter(wind_dir != 0) %>% \n  mutate(wind_dir_deg = wind_dir*10) %>% \n  ggplot(aes(x = date, y = wind_dir_deg)) +\n  geom_point(colour = \"#3182bd\", alpha = .7) +\n  facet_wrap(~wind_spd_cat) +\n  theme_minimal() +\n  labs(x = NULL, y = \"wind direction (degrees true)\",\n       title = \"Wind Direction & Average Hourly Wind Speed Measured\\nat Esquimalt Harbour (1994-2019)\",\n       caption = \"*Data sourced from Environment Canada using the weathercan R package\") +\n  scale_y_continuous(limits = c(-5, 365),\n                     breaks = seq(0, 360, 60),\n                     expand = c(0, 0)) +\n  theme(axis.text = element_text(size = 10),\n        axis.title = element_text(size = 12),\n        strip.text = element_text(size = 10, face = \"bold\"),\n        plot.title = element_text(size = 12, face = \"bold\"),\n        plot.margin = unit(c(4,50,4,4),\"mm\"))\nwind_plot\n\nGet fancy with the magick R package üì¶ and overlay my sad fence picture:\nlibrary(magick)\n\nwind_plot_img <- image_read(\"tmp/wind_dir_plot.png\")\nfence_img <- image_read(\"images/fence.jpg\")\n\nfinal_img <- image_composite(image_scale(wind_plot_img, \"x800\"),\n                             image_scale(fence_img, \"x150\"),\n                             offset = \"+900+550\")\nfinal_img <- image_draw(final_img)\nrect(860, 540, 1110, 725, border = \"red\", lty = \"dashed\", lwd = 3)\nfinal_img\n\n\nOr get fancy in a different way by using a polar coordinate system ü§ì:\n<    wind_circle_facet <- wind_dir %>% \n      filter(wind_dir != 0) %>% \n      mutate(wind_dir_deg = wind_dir*10,\n             event = case_when(date == \"2019-02-09\" ~ \"Feb 9th 2019\",\n                               TRUE ~ \"1994 to Feb 8th 2019\")) %>% \n      ggplot(aes(x = wind_dir_deg, y = wind_spd, group = event, colour = event)) +\n      geom_point(alpha = .7, size = 2, position = \"jitter\") +\n      coord_polar() +\n      theme_minimal() +\n      facet_wrap(~wind_spd_cat) +\n      scale_colour_manual(name = NULL,\n                          values = c(\"Feb 9th 2019\" = \"red\",\n                                      \"1994 to Feb 8th 2019\" = \"#3182bd\")) +\n      scale_x_continuous(\n                         breaks = c(360, 90, 180, 270),\n                         labels = c(\"North\\n(360)\", \"East\\n(90)\", \"South\\n(180)\", \"West\\n(270)\")) +\n      scale_y_continuous(limits = c(0, 70)) +\n      labs(x = \"wind direction (degrees true)\",\n           y = \"wind speed (km/h)\",\n           title = \"Wind Direction for Average Hourly Wind Speeds\\nRecorded at Esquimalt Harbour (1994-2019)\") +\n      theme(plot.title = element_text(hjust = 0.5, face = \"bold\", size = 8),\n            axis.title = element_text(size = 8),\n            axis.text = element_text(size = 5),\n            strip.text = element_text(size = 7, face = \"bold\"),\n            legend.text = element_text(size = 6))\n    wind_circle_facet\n\n\n\nThis blog post was originally published through GitHub.\n\n\n\n\n\n",
    "preview": "posts/2019-02-26-wind-direction/images/final_plot-1.png",
    "last_modified": "2020-10-08T22:15:10-07:00",
    "input_file": {},
    "preview_width": 1120,
    "preview_height": 800
  },
  {
    "path": "posts/2019-02-25-fence/",
    "title": "Weather with {weathercan} üá®üá¶",
    "description": "Using the {weathercan} R package üì¶ to examine local wind patterns in Victoria, B.C.",
    "author": [],
    "date": "2019-02-25",
    "categories": [],
    "contents": "\nVictoria, British Columbia‚Äîwhere I live‚Äîhas had a bit of wintery weather this year. And.\nThis happened üò±\n\nTo be fair, Environment and Climate Change Canada‚Äôs special weather warning that day did say winds could damage buildings and structures. But seriously, how windy does it need to be to blow down my 2-year-old fence?\nI decided to turn this mini-homeowner drama into a reason to try out the rOpenSci weathercan R package üì¶. weathercan makes it easier to search for and download weather data from the Environment and Climate Change Canada (ECCC) website.\nLet‚Äôs find the nearby ECCC weather stations using weathercan::station_search():\nlibrary(weathercan)\n\nstns <- stations_search(name = \"Esquimalt\")\nstns\n## # A tibble: 7 x 13\n##   prov  station_name station_id climate_id WMO_id TC_id   lat   lon  elev\n##   <fct> <chr>        <fct>      <fct>      <fct>  <fct> <dbl> <dbl> <dbl>\n## 1 BC    ESQUIMALT    50         1012700    <NA>   <NA>   48.4 -123.  13.7\n## 2 BC    ESQUIMALT    50         1012700    <NA>   <NA>   48.4 -123.  13.7\n## 3 BC    ESQUIMALT H‚Ä¶ 52         1012710    71798  WPF    48.4 -123.   3  \n## 4 BC    ESQUIMALT H‚Ä¶ 52         1012710    71798  WPF    48.4 -123.   3  \n## 5 BC    ESQUIMALT H‚Ä¶ 52         1012710    71798  WPF    48.4 -123.   3  \n## 6 BC    ESQUIMALT L‚Ä¶ 51         1012707    <NA>   <NA>   48.4 -123.  15.2\n## 7 BC    ESQUIMALT L‚Ä¶ 51         1012707    <NA>   <NA>   48.4 -123.  15.2\n## # ‚Ä¶ with 4 more variables: tz <chr>, interval <chr>, start <int>,\n## #   end <int>\nLooks like 3 stations for Esquimalt in the station list, however only one‚ÄîESQUIMALT HARBOUR (52)‚Äîis currently collecting hourly data.\nstn52 <- stns %>% filter(end == 2018 & interval == \"hour\")\nA quick map with the bcmaps & sf R packages confirms the station (red point) is actually in Esquimalt:\n#municipalities in the Capital Regional District\ncrd <- c(\"Central Saanich\", \"Colwood\", \"Esquimalt\", \"Highlands\",\n         \"Langford\", \"Metchosin\", \"North Saanich\", \"Oak Bay\", \"Saanich\",\n         \"Sidney\", \"Sooke\", \"Victoria\", \"View Royal\")\n\nesq <- municipalities() %>% \n  filter(ADMIN_AREA_ABBREVIATION == \"Esquimalt\")\n\nbcmaps::municipalities() %>% \n  filter(ADMIN_AREA_ABBREVIATION %in% crd) %>% \n  ggplot() +\n  geom_sf() +\n  geom_sf(data = esq, fill = \"grey10\") +\n  geom_sf(data = st_as_sf(stn52, coords = c(\"lon\", \"lat\"),\n                          crs = 4326),\n  size = 4, colour = \"red\", show.legend = TRUE) +\n  coord_sf(datum = NA) +\n  labs(title = \"Township of Esquimalt & Surrounding\\nMunicipalities of the Capital Region District \") +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5))\n\nSo let‚Äôs grab all the data for station #52 ESQUIMALT HARBOUR using weathercan::weather_dl() and have a look at the wind speeds:\ndata <- weather_dl(station_ids = 52)\n\ndata %>%\n  select(station_id, station_name, date, wind_spd) %>%\n  ggplot(aes(x = date, y = wind_spd)) +\n  geom_point(colour = \"#3182bd\", alpha = .7) +\n  theme_minimal() +\n  labs(x = NULL, y = \"avg hourly wind speed (km/h)\",\n       title = \"Average Hourly Wind Speeds Measured at Esquimalt Harbour\") +\n  geom_hline(yintercept = 50, linetype = 2) +\n  scale_y_continuous(limits = c(0, 70),\n                     breaks = seq(0, 70, 10),\n                     expand = c(0, 0))\n\nWell, that was disapointing üòû, looks like the recent high winds were not that unique afterall‚Äîlot‚Äôs of average wind speeds in the same range or even higher in the past couple decades. I was hoping for something much more dramatic (read explanatory). As a side note, there looks like there was an instrument change in 2014? ü§∑\nBut I am not ready to give up. The fence was only built in April 2017‚Äîmaybe we should look at wind speeds since then?\np1 <- data %>%\n  select(station_id, station_name, date, wind_spd) %>%\n  filter(date > \"2017-04-01\") %>%\n  ggplot(aes(x = date, y = wind_spd)) +\n  geom_point(colour = \"#3182bd\", alpha = .7) +\n  theme_minimal() +\n  labs(x = NULL, y = \"avg hourly wind speed (km/h)\",\n       title = \"Wind Speeds Since Fence was Built\") +\n  geom_hline(yintercept = 50, linetype = 2) +\n  scale_y_continuous(limits = c(0, 60),\n                     breaks = seq(0, 60, 10),\n                     expand = c(0, 0))\n\np2 <- data %>%\n  select(station_id, station_name, date, wind_spd) %>%\n  filter(date > \"2018-12-10\") %>%\n  ggplot(aes(x = date, y = wind_spd)) +\n  geom_point(colour = \"#3182bd\", alpha = .7) +\n  theme_minimal() +\n  labs(x = NULL, y = \"avg hourly wind speed (km/h)\",\n       title = \"Wind Speeds During Recent Storms\") +\n  geom_hline(yintercept = 50, linetype = 2) +\n  scale_y_continuous(limits = c(0, 60),\n                     breaks = seq(0, 60, 10),\n                     expand = c(0, 0))\n\np1 + p2\n\nüéâ The recent blast of wintery weather was the first test of the fence afterall. But why did the fence fair OK with the December winds but fall over in February? There is a fair bit of over-plotting with these points, so let‚Äôs look even closer üëÄ:\np3 <- data %>%\n  select(station_id, station_name, date, time, wind_spd) %>%\n  filter(time >=\"2018-12-20 04:00:00\" & date < \"2018-12-21 04:00:00\") %>%\n  ggplot(aes(x = time, y = wind_spd)) +\n  geom_point(colour = \"#3182bd\", alpha = .7) +\n  theme_minimal() +\n  labs(x = NULL, y = \"avg hourly wind speed (km/h)\",\n       title = \"December Wind Storm\") +\n  geom_hline(yintercept = 50, linetype = 2) +\n  scale_y_continuous(limits = c(0, 60),\n                     breaks = seq(0, 60, 10),\n                     expand = c(0, 0))\n\np4 <- data %>%\n  select(station_id, station_name, date, time, wind_spd) %>%\n  filter(time >=\"2019-02-08 14:00:00\" & date < \"2019-02-10 00:00:00\") %>%\n  ggplot(aes(x = time, y = wind_spd)) +\n  geom_point(colour = \"#3182bd\", alpha = .7) +\n  theme_minimal() +\n  labs(x = NULL, y = \"avg hourly wind speed (km/h)\",\n       title = \"February Wind Storm\") +\n  geom_hline(yintercept = 50, linetype = 2) +\n  scale_y_continuous(limits = c(0, 60),\n                     breaks = seq(0, 60, 10),\n                     expand = c(0, 0))\n\np3 + p4\n\nWell one thing we can say about the February storm is that it went on, and on, and on‚Äîhigh winds recorded for over 12 hours üí®! Maybe that is what did my new fence in? Or, maybe it was not average hourly wind speeds but wind gust speeds? Unfortunately wind gust speed is not available in the Environment and Climate Change Canada (ECCC) data set.\nAh well. Maybe fence version 1 was just not meant to be‚Äîversion 2 is underway and will be ready for future winter weather üá®üá¶.\nThe weathercan R package is part of the rOpenSci project‚Äîthey are transforming science through open data and software üíØ\nLearn more weathercan authored by Steffi LaZerte & Sam Albers here\nThe R source code for this post can be reviewed here\nThis blog post was originally published through GitHub.\n\n\n\n\n",
    "preview": "posts/2019-02-25-fence/images/fence.jpg",
    "last_modified": "2020-10-02T21:38:07-07:00",
    "input_file": {}
  },
  {
    "path": "posts/2018-10-16-sd61-kids/",
    "title": "The Kids Are Coming, Let‚Äôs Get Ready",
    "description": "Exploring patterns of student population change in Greater Victoria, B.C.",
    "author": [],
    "date": "2018-10-16",
    "categories": [],
    "contents": "\nWe are in the campaign period for the British Columbia 2018 General Local Elections. I live in the Township of Esquimalt üèô‚Äîan amazing community. However, there is always room to improve, even on amazing. I have enjoyed talking with our local government candidates, in particular about what issues motivated them to campaign to step into such important roles‚Äîthe housing crisis, responsible development, community building. In turn, I have had a fair bit to say about issues on my mind, such as climate change (this üò±), reducing speed limits in neighbourhood areas üöó, more and safer bike paths for family cycling üö≤, and, schools. Specifically, space in our only catchment elementary school‚ÄîL‚ÄôEcole Macaulay Elementary.\nEsquimalt used to have 2 catchment elementary schools, Lampson Street & Macaulay (Ecole Victor-Brodeur is also in Esquimalt, a school that serves the francophone community). Lampson, a school building with an impressive history in the region, was closed as a catchment elementary school in 2007 due to declining enrolment.\nHowever, things have and are changing‚Äîand pretty fast.\nDue to the recent, legal change to revert class size & composition back to 2002 levels, as well as a growing population‚ÄîMacaulay has added one or more new classes in each of the 3 years I have had kids in the school, as have many elementary schools throughout the Capital Regional District. Macaulay has over 470 kids enrolled this year, so I have been talking üó£ to candidates about how Macaulay is pretty full‚Äîand I think we need a plan for the kids that are still to come.\nI thought it would be interesting to support this discussion with some data. Also, I am always keen to work on my R skills üë©‚Äçüíª. So here it goes.\nPopulation Change in Victoria Census Metropolitan Area (2001-2017)\nLet‚Äôs start by pulling some population estimate data from Statistics Canada‚ÄîI found data for each Census Metropolitan Area by age group. Perfect. I had to Google to learn about what the Victoria Census Metropolitan Area (CMA) actually includes, turns out it includes all of the Capital Regional District minus the Gulf Islands. Let‚Äôs have a look üëÄ:\nClick to see the R code for the Victoria CMA plots\n## Data: Victoria Census Metropolitan Census Area (British Columbia) Population\n## Estimates [Table: 17-10-0078-01 (formerly CANSIM  051-0056) from Statistics Canada\n\n#get Statistics Canada data using cansim package\nbc_popn <- get_cansim(1710007801) %>%\n  filter(GEO == \"Victoria, British Columbia\",\n         Sex == \"Both sexes\") %>%\n  select(year = REF_DATE, age_group = `Age group`, population_estimate = VALUE) %>% \n  mutate(year = as.integer(year))\n\n#make plot of Victoria CMA population estimates\ncma_plot <- bc_popn %>% \n  filter(age_group == \"All ages\") %>% \n  ggplot(aes(x = year, y = population_estimate, group = 1)) + \n  geom_line(size = 1, colour = \"#54278f\") +\n  scale_x_continuous(limits = c(2001, 2018),\n                     breaks = seq(2002, 2017, 3),\n                     expand = c(0,0)) +\n  scale_y_continuous(limits = c(320000, 380000),\n                     breaks = seq(320000, 380000, 5000),\n                     expand = c(0,0), labels = comma) +\n  labs(title = \"Population Estimates for Victoria CMA\",\n       subtitle = \"Include all ages\",\n       caption = \"Data sourced from Statistics Canada\") +\n  theme_minimal() +\n  theme_plots\n\n#kid age groups\nkid_ages <- c(\"0 to 4 years\", \"5 to 9 years\", \"10 to 14 years\", \"15 to 19 years\")\n\n#make plot of kid Victoria CMA population estimates\ncma_kids_plot <- bc_popn %>% \n  filter(age_group %in% kid_ages) %>% \n  group_by(year) %>% \n  summarise(population_estimate = sum(population_estimate)) %>% \n  ggplot(aes(x = year, y = population_estimate, group = 1)) + \n  geom_line(size = 1, colour = \"#54278f\") +\n  scale_x_continuous(limits = c(2001, 2018),\n                     breaks = seq(2002, 2017, 3),\n                     expand = c(0,0)) +\n  scale_y_continuous(limits = c(64000, 70000),\n                     breaks = seq(64000, 70000, 500),\n                     expand = c(0,0), labels = comma) +\n  labs(title = \"Kid Population Estimates for Victoria CMA\",\n       subtitle = \"Kids include ages 0 to 19 years\",\n       caption = \"Data sourced from Statistics Canada\") +\n  theme_minimal() +\n  theme_plots\n#plot the Victoria CMA plots\ncma_plot + cma_kids_plot\n\nThe Statistics Canada data confirms what we hear all the time, the population in the Victoria CMA has been steadily increasing since 2001. But not due to more kids‚Äîthe population of 0 to 19 year olds steadily declined from 2001 until 2014. This explains the decline in enrolment‚Äîand School District decisions to close schools at that time. However, 2014 brings a clear change‚Äîkid numbers start increasing. But what about in the Township of Esquimalt?\nPopulation Change in the Township of Esquimalt (2001-2017)\nI found some population data for Municipalities from BCStats, but unfortunately not by age group üòû.\nClick to see the R code for the Esquimalt plot & map\n## Data: Esquimalt District Municipality population estimates from\n## BCStats Population Estimates webpage\n\n#municipalities I want\ncrd <- c(\"Central Saanich\", \"Colwood\", \"Esquimalt\", \"Highlands\",\n         \"Langford\", \"Metchosin\", \"North Saanich\", \"Oak Bay\", \"Saanich\",\n         \"Sidney\", \"Sooke\", \"Victoria\", \"View Royal\")\n\n#get the 2001-2011 CRD population estimate data file \nbcstats_mun_2001_2011 <- \n  \"http://www.bcstats.gov.bc.ca/Files/0379a32f-cec8-438d-83e0-6724b2a2a272/BCDevelopmentRegionRegionalDistrictandMuncipalPopulationEstimates2001-2011.xls\"\n\nget_mun_2001_2011 <- curl_download(bcstats_mun_2001_2011,\n                                   destfile = glue(path, \"/bcstats_mun_2001_2011.xls\"))\n\ncrd_2001_2011 <- read_xls(get_mun_2001_2011, skip = 3) %>%  \n  filter(Name %in% crd) %>% \n  select(-`2011`, -Type, -SGC)\n\n# get 2011-2017 CRD population estimate data file and merge data with the 2001-2011 data \nbcstats_mun_2011_2017 <- \n  \"http://www.bcstats.gov.bc.ca/Files/285cd56c-9be1-4c5e-a153-3deeffa2ac94/BCDevelopmentRegionRegionalDistrictandMuncipalPopulationEstimates2011-2015.xls\"\n\nget_mun_2011_2017 <- curl_download(bcstats_mun_2011_2017,\n                                   destfile = glue(path, \"/bcstats_mun_2011_2017.xls\"))\n\ncrd_2001_2017 <- read_xls(get_mun_2011_2017, range = (\"A3:J48\")) %>% \n  filter(Name %in% crd) %>% \n  bind_cols(crd_2001_2011) %>% \n  select(-`2011`, -`Area Type`, -SGC, -Name1) %>% \n  gather(key =  year, value = population_estimate, -Name) %>% \n  mutate(population_estimate = as.numeric(population_estimate),\n         year = as.integer(year)) %>% \n  arrange(year)\n\n#plot of Township of Esquimalt population estimates\nesquimalt_plot <- crd_2001_2017 %>% \n  filter(Name == \"Esquimalt\") %>%\n  ggplot(aes(x = year, y = population_estimate, group = 1)) + \n  geom_line(size = 1, colour = \"#54278f\") +\n  labs(title = \"Population Estimates for Esquimalt\",\n       subtitle = \"Includes all ages\",\n       caption = \"Data sourced from BCStats\") +\n   scale_x_continuous(limits = c(2001, 2018),\n                     breaks = seq(2002, 2017, 3),\n                     expand = c(0,0)) +\n  scale_y_continuous(limits = c(16400, 17600),\n                     breaks = seq(16400, 17600, 100),\n                     expand = c(0,0), labels = comma) +\n  theme_minimal() +\n  theme_plots\n\n#calculate municipality population change for 2015 to 2017\ncrd_change <- crd_2001_2017 %>% \n  filter(year %in% c(2015, 2017)) %>%\n  group_by(Name) %>% \n  mutate(popchange = population_estimate-lag(population_estimate)) %>% \n  mutate(percchange = round((popchange/lag(population_estimate) * 100), digits = 0)) %>% \n  filter(year == 2017) %>% \n  select(-year) \n\n#map 2 year % population change for municipalities\ncrd_change_spatial <- municipalities() %>% \n  filter(ADMIN_AREA_ABBREVIATION %in% crd) %>% \n  mutate(Name = ADMIN_AREA_ABBREVIATION) %>% \n  left_join(crd_change) %>% \n  ggplot() +\n  geom_sf(aes(fill = percchange)) +\n  coord_sf(datum = NA) +\n  labs(title = \"CRD Percent Population Change 2015-2017\",\n       subtitle = \"Includes all ages\",\n       caption = \"Data sourced from BCStats\") +\n  scale_fill_gradient(name = \"Percent\\nChange\", low = \"#bcbddc\", high = \"#132B43\") +\n  theme_minimal() +\n  theme_plots\n#plot the Esquimalt plots\nesquimalt_plot + crd_change_spatial\n\nThe Township of Esquimalt population has been a bit more variable since 2001, with a declining pattern from 2006 to 2013. However, there has been an uptick in recent years. In fact, all the Greater Victoria municipalities‚Äîexcept North Saanich‚Äîhad a measurable increase in popuation over the last 2 years‚ÄîVictoria a 1% increase, Esquimalt 3% and Sooke 11%! Wow, that is a lot.\nWhat I really want to know is how the population of kids is changing in Esquimalt. I was not able to find population-by-age data for Esquimalt, but I did find it for the Greater Victoria School Districts.\nKid Population Change in School District 61-Greater Victoria\nClick to see the R code for the SD61 plots\n## Data: School District 61 Population Estimates & Projections from BCStats manual \n## online tool: https://www.bcstats.gov.bc.ca/apps/PopulationProjections.aspx\n\n#get SD61 population estimates & projections\nsd61_kids <- read_csv(glue(path, \"/Population_Projections.csv\")) %>% \n  select(Year, \"<1\", \"1-4\", \"5-9\", \"10-14\", \"15-19\") %>% \n  gather(key = age_group, value = population_estimate, -Year) %>% \n  filter(Year < 2038) %>% \n  mutate(age_group = factor(age_group, ordered = TRUE,\n                            levels = c(\"<1\", \"1-4\", \"5-9\", \"10-14\", \"15-19\")),\n         data_type = case_when(Year < 2018 ~ \"estimated\",\n                               TRUE ~ \"projected\"))\n\n#plot of kid population estimates in SD61 by age group\nsd61_kids_line_plot <- sd61_kids %>% \n  filter(age_group != \"<1\") %>% \n  ggplot(aes(Year, population_estimate, group = age_group, colour = data_type)) +\n  geom_line(size = 1) +\n  geom_segment(aes(xend = 2037 , yend = population_estimate), linetype = 2, colour = 'grey') + \n  geom_point(size = 2) + \n  geom_text(aes(x = 2037.1 , label = age_group), hjust = 0, colour = \"#54278f\") + \n  coord_cartesian(clip = 'off') + \n  labs(title = \"Kid Population Estimates & Projections by Age Group for SD61\",\n       # subtitle = \"Kids include ages 1 to 19 years\",\n       caption = \"Data sourced from BCStats\") +\n  theme(plot.margin = margin(5.5, 0, 5.5, 5.5)) +\n  scale_x_continuous(limits = c(1984, 2040), breaks = seq(1986, 2038, 5), expand = c(0,0)) +\n  scale_y_continuous(breaks = seq(6000, 13000, 1000), expand = c(0,0), labels = comma) +\n  scale_colour_manual(name = \"\", values = c(\"#54278f\", \"#9e9ac8\")) +\n  scale_fill_manual(name = \"\", values = c(\"#54278f\", \"#9e9ac8\")) +\n  theme_minimal() +\n  theme_plots +\n  theme(legend.position = \"top\",\n        legend.text = element_text(size = 12))\n\n#plot of total sd61 kid population estimates\nsd61_kids_total_plot <- sd61_kids %>% \n  group_by(Year, data_type) %>% \n  summarise(population_estimate = sum(population_estimate))  %>% \n  ggplot(aes(x = Year, y = population_estimate, colour = data_type, group = 1)) + \n  geom_point() +\n  geom_line(size = 1) +\n  labs(title = \"Kid Population Estimates & Projections for SD61\",\n       subtitle = \"Kids include ages 0 to 19 years\",\n       caption = \"Data sourced from BCStats\") +\n  scale_x_continuous(limits = c(1984, 2040), breaks = seq(1986, 2038, 5), expand = c(0,0)) +\n  scale_y_continuous(limits = c(35000, 43000), breaks = seq(35000, 43000, 500), expand = c(0,0), labels = comma) +\n  scale_colour_manual(name = \"\", values = c(\"#54278f\", \"#9e9ac8\")) +\n  theme_minimal() +\n  theme_plots +\n  theme(legend.position = c(.2,.2),\n        legend.text = element_text(size = 12)) \n#animate the sd61 age group plot\nsd61_kids_line_plot +\n  transition_reveal(age_group, Year)\n\n#plot the sd61 total line plot\nsd61_kids_total_plot\n\nThe School District 61 data shows a similar pattern to what we have already observed‚Äî population declines for all kid age groups through the 2000s. We see the recent increases, and the projected increases to come‚Äîfor at least the next 15 years! I confess that while the animated plot is fun to make ü§ì, rolling the kid age group populations together and keeping things still really tells the story:\n\nYep, The Kids Are Coming\nOur Esquimalt catchment elementary school is full and the kid population estimate lines are going up‚Äîand predicted to do so for at least the next 15 years üìà. In my opinion, a plan for the kids that are still to come should be on the to-do list üìú for the Township of Esquimalt. The elementary school space crunch has already had community impacts throughout the Capital Regional District, displacing dedicated computer labs, after-school care situations, pre-schools. The School District recently launched a Catchment Boundary Review & Public Consultation‚Äîa great step in supporting planning. However, with only one catchment school and one boundary, I think it is also time to talk about bringing a second catchment elementary school (back) on line for Esquimalt kids üè´.\nDetails on the data sources (e.g.¬†website url, licences) are here\nThe R source code can be reviewed here\nLearn more about the CRD & Township of Esquimalt candidates here\nDon‚Äôt forget to get out and VOTE on October 20th, 2018\nThis blog post was originally published through GitHub.\n\n\n\n\n\n",
    "preview": "posts/2018-10-16-sd61-kids/sd61-kids_files/sd61-actual-plots-1.png",
    "last_modified": "2020-10-02T21:38:07-07:00",
    "input_file": {},
    "preview_width": 768,
    "preview_height": 576
  },
  {
    "path": "posts/2018-05-02-ruhu-ebird-observations/",
    "title": "Where aRe the Rufous Hummingbirds?",
    "description": "Exploring patterns of observation frequency of Rufous Hummingbirds along the Pacific Coast",
    "author": [],
    "date": "2018-05-02",
    "categories": [],
    "contents": "\n\nWhen I saw the above analysis by my friend Dave Fraser, I thought üí≠:\ncool analysis!\ncitizen science + eBird is awesome!\nhave I seen a Rufous Hummingbird üê¶ lately?\nand then I thought ‚Ä¶\nmaybe you could do that analysis in R? üí°\nAnd it turns out you can.\nGetting the eBird Data\nYou can get up-to-date eBird data via the eBird website‚Äôs View & Explore options, but I was hoping to include more historical data and didn‚Äôt want to click that often. The full eBird data set is available for download, but it is updated quarterly‚Äîso will not have the very recent observation records we are after. Sigh üòû.\nThen I talked to Andy Teucher about my eBird data woes. He introduced me to the rOpenSci R package üì¶ rebird‚Äîhe is one of the package coauthors! üëç\nThe rebird package üì¶ provides an interface with the eBird webservices‚Äîwhich in regular english means it goes and gets the eBird data from the web. It also returns the data in a tidy format, meaning the data are ready to work with the popular tidyverse R packages üì¶ that many of us new to R have used to ease our way into coding.\nOK, so let‚Äôs start by pulling A LOT of eBird data‚Äî50 years seems like a lot?\n#load R packages we will need for getting the data\nlibrary(rebird) #get eBird data from the web using ebirdfreq()\nlibrary(dplyr) #data munging\nlibrary(purrr) #map() for looping\n\n#thanks Andy for the purrr help!\n#function to get eBird data for many states/provinces using rebird R package\nmap_state <-  function(state) {\n  map_dfr(1968:2018, ~ {\n    ebirdfreq(\"states\", state, .x, .x, 1, 5) %>%\n      filter(comName == \"Rufous Hummingbird\") %>%\n      mutate(year = .x, state = state)\n  })\n}\n\n#get eBird data for west coast state/provinces\nruhu_raw <- map_dfr(c(\"CA-BC\",\"US-CA\",\"US-WA\", \"US-OR\"), ~ {\n      map_state(.x)\n})\n\nhead(ruhu_raw)\n## # A tibble: 6 x 6\n##   comName            monthQt    frequency sampleSize  year state\n##   <chr>              <chr>          <dbl>      <dbl> <int> <chr>\n## 1 Rufous Hummingbird January-1         0.        14.  1968 CA-BC\n## 2 Rufous Hummingbird January-2         0.         9.  1968 CA-BC\n## 3 Rufous Hummingbird January-3         0.        11.  1968 CA-BC\n## 4 Rufous Hummingbird January-4         0.        14.  1968 CA-BC\n## 5 Rufous Hummingbird February-1        0.        15.  1968 CA-BC\n## 6 Rufous Hummingbird February-2        0.        14.  1968 CA-BC\nThe eBird data provided by rebird is indeed very tidy. üéÅ Let‚Äôs take a moment to cheers the authors of and contributers to this open source R package. üéâ\nSome Data Wrangling\nThere is still a bit of data cleaning or wrangling to do‚Äîthere alway is and it would be less fun if there wasn‚Äôt üòâ. We need to do something with the monthQt variable. This is our time variable, which we need for plotting. Right now it is coded as a character variable and it needs to be recognized as a date. And you might notice some zeros in the 2018 weeks that we have not yet lived‚Äîor birded. Let‚Äôs filter out those zeros, they should really have been NAs?\n#we need a few more packages\nlibrary(stringr) #clean up variables\nlibrary(lubridate) #make date data dates\nlibrary(tidyr) #separate month and quarter\n\nruhu_clean <- ruhu_raw %>% \n  separate(monthQt, c(\"month\", \"week\"), sep = \"-\") %>%\n  mutate(day = case_when(\n    week == 1 ~ 1,\n    week == 2 ~ 8,\n    week == 3 ~ 15,\n    week == 4 ~ 23\n  )) %>%\n  mutate(date = ymd(paste0(year, \"-\",month,\"-\",day))) %>% \n  mutate(week = lubridate::week(date)) %>% \n  filter(sampleSize != 0) #filter out any zero that is actually an NA\n\nhead(ruhu_clean)\n## # A tibble: 6 x 9\n##   comName    month  week frequency sampleSize  year state   day date      \n##   <chr>      <chr> <dbl>     <dbl>      <dbl> <int> <chr> <dbl> <date>    \n## 1 Rufous Hu‚Ä¶ Janu‚Ä¶    1.        0.        14.  1968 CA-BC    1. 1968-01-01\n## 2 Rufous Hu‚Ä¶ Janu‚Ä¶    2.        0.         9.  1968 CA-BC    8. 1968-01-08\n## 3 Rufous Hu‚Ä¶ Janu‚Ä¶    3.        0.        11.  1968 CA-BC   15. 1968-01-15\n## 4 Rufous Hu‚Ä¶ Janu‚Ä¶    4.        0.        14.  1968 CA-BC   23. 1968-01-23\n## 5 Rufous Hu‚Ä¶ Febr‚Ä¶    5.        0.        15.  1968 CA-BC    1. 1968-02-01\n## 6 Rufous Hu‚Ä¶ Febr‚Ä¶    6.        0.        14.  1968 CA-BC    8. 1968-02-08\nThat looks üëÄ better!\nSome Exploratory Data Visualizing\nNow let‚Äôs have a quick, exploratory look üëÄ at what data we have, starting just with British Columbia.\n#we need another package\nlibrary(ggplot2) #plotting\n\nruhu_clean %>% \n  filter(state == \"CA-BC\") %>%  #just B.C.\n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(colour = \"grey\") +\n  theme_minimal()\n\nThere seems to be a lot of very high frequency values in the data set (frequency = 1.0), which is a bit puzzling‚Äîall the birds observed were Rufous Hummingbirds ‚ùì. Let‚Äôs colour the lines for each year‚Äîusing a continuous colour scale‚Äîto see if we learn something.\nruhu_clean %>% \n  filter(state == \"CA-BC\") %>%  #just B.C.\n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = year)) +\n  theme_minimal()\n\nHmmmmm‚Ä¶this shows that most of that puzzling data is pre-2000s. eBird launched in 2002, with birders able to enter observations instantly via smartphones. Andy‚Äîa birder and contributor to eBird‚Äîmentioned that maybe the older records are being entered by birders going through past checklists & field notebooks. Filtering out the pre-2002 data seems like a reasonable approach?\nruhu_since_2002 <- ruhu_clean %>% \n  filter(year > 2001) \n\nruhu_since_2002 %>% \n  filter(state == \"CA-BC\") %>%  #just B.C.\n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = year)) +\n  theme_minimal()\n\nLooks üëÄ better!\nHow Do 2018 üê¶ Observation Frequencies Compare with Historical Data?\nLet‚Äôs use some colour to distinguish the 2018 data from the 2002-2017 observation frequencies.\n#make a small df with just 2018 data\ndf_bc_2018 <- ruhu_since_2002 %>% \n  filter(state == \"CA-BC\", year == 2018) \n\nruhu_since_2002 %>% \n  filter(state == \"CA-BC\") %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_bc_2018, aes(colour = \"red\")) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"red\")) +\n  theme_minimal()\n\nThis plot confirms the original analysis with the first 2018 Rufous Hummingbird observations later than most years since 2002. However, the rate of increase in observation frequency seems to be similar.\nLet‚Äôs look at all the Pacific Coast data now?\n#make a small df with just 2018 data\ndf_2018 <- ruhu_since_2002 %>% \n  filter(year == 2018) \n\nruhu_since_2002 %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_2018, aes(colour = \"red\")) +\n  facet_wrap(~ state, ncol=1) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"red\")) +\n  theme_minimal()\n\nInteresting! But wait, while I‚Äôd like California to be a bit closer to British Columbia, I think I want the order of my facet plots to mirror the order along the Pacific Coast. Let‚Äôs make sure the variable state is a factor and in the order we want for plotting.\n#we need another package\nlibrary(forcats) #for wrangling factors\n\n#order for facet plotting\nwc_order <- c(\"CA-BC\",\"US-WA\",\"US-OR\",\"US-CA\")\n\n#make state a factor and order for facet plotting\nruhu_since_2002 <- ruhu_since_2002 %>% \n  mutate(state = factor(state, levels = wc_order))\n\n#make a small df with just 2018 data\ndf_2018 <- ruhu_since_2002 %>% \n  filter(year == 2018) \n\nruhu_since_2002 %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_2018, aes(colour = \"red\")) +\n  facet_wrap(~ state, ncol=1) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"red\")) +\n  theme_minimal()\n\nLooks üëÄ better!\nAnd again, the plot confirms the original analysis‚Äîfirst observations are later and frequencies are lower for Rufous Hummingbirds, especially in Oregon, Washington and British Columbia.\nLet‚Äôs finish up with some window dressing for our plots, adding the usual suspects like a title and data attribution, and adding a nice silhouette of a hummingbird using the rphylopic R package üì¶. Andy even suggested using the rufous colour‚ÄîüíØ.\nSo final plot for British Columbia:\n#we need a couple more packages\nlibrary(rphylopic) #for image, package from GitHub\nlibrary(curl) #required by rphylopic function\n\n## add image\nhummer <- image_data(\"679605a3-95f1-4f57-be33-568640aca7b9\", size = \"512\")[[1]]\n\n#make a small df with just 2018 data\ndf_bc_2018 <- ruhu_since_2002 %>% \n  filter(state == \"CA-BC\", year == 2018) \n\nruhu_since_2002 %>% \n  filter(state == \"CA-BC\") %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_bc_2018, aes(colour = \"orange3\")) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"orange3\")) +\n  labs(title = \"Frequency of Rufous Hummingbird Observations\\nin British Columbia (2002-2018)\",\n       caption = \"Data from eBird\") +\n  theme_minimal() +\n  theme(legend.position = c(0.15, 0.3)) +\n  add_phylopic(hummer, alpha = .7, color = \"orange3\", ysize = 7, x = 45, y = .3)\n\nand final plot for the Pacific Coast:\n#order for facet plotting\nwc_order <- c(\"CA-BC\",\"US-WA\",\"US-OR\",\"US-CA\")\n\n#make state a factor and order for facet plotting\nruhu_since_2002 <- ruhu_since_2002 %>% \n  mutate(state = factor(state, levels = wc_order))\n\n#make a small df with just 2018 data\ndf_2018 <- ruhu_since_2002 %>% \n  filter(year == 2018) \n\nruhu_since_2002 %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_2018, aes(colour = \"orange3\")) +\n  facet_wrap(~ state, ncol=1) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"orange3\")) +\n  labs(title = \"Frequency of Rufous Hummingbird Observations\\nAlong the Pacific Coast (2002-2018)\",\n       caption = \"Data from eBird\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\") +\n  add_phylopic(hummer, alpha = .7, color = \"orange3\", ysize = 3, x = 45, y = .3)\n\nOK, I know. The silhouette is not a Rufous Hummingbird. It is a Topazza pella‚Äîthe Crimson Topaz‚Äîthe only hummingbird image in the phylopic library. At least it is a hummingbird?\nFor more on Rufous Hummingbirds (Selasphorus rufus), you can read the species account in the The Birds of North America series.\nFor keeping up with cool nature stuff in Victoria, British Columbia, you can follow the Victoria Natural History Society twitter feed.\nIf you see üëÄ a Rufous Hummingbird, you can add your observation to eBird.\n\nADDENDUM: AUK & a better hummingbird image\n\nIf you want to wrangle the full eBird data set, you might want to check out the R package üì¶ AUK, also recently onboarded at rOpenSci.\nAnd thanks to the above tweet from phylopic, we have a final, final set of plots with an improved hummingbird image üòÑ.\n\n\n\n\nThis exploration was a collaboration with Andy Teucher‚ÄîAndy told me about rebird üì¶, provided help with loops using the purrr üì¶, along with many other gReat suggestions. This blog post was originally published through GitHub.\n\n\n\n",
    "preview": "posts/2018-05-02-ruhu-ebird-observations/ruhu-ebird-observations_files/final-bc-plot-1.png",
    "last_modified": "2020-10-02T21:38:07-07:00",
    "input_file": {},
    "preview_width": 768,
    "preview_height": 576
  }
]
