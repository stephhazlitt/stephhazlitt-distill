[
  {
    "path": "posts/2018-05-02-ruhu-ebird-observations/",
    "title": "Where aRe the Rufous Hummingbirds?",
    "description": "Exploring patterns of observation frequency of Rufous Hummingbirds along the Pacific Coast.",
    "author": [],
    "date": "2018-05-02",
    "categories": [],
    "contents": "\n\nWhen I saw the above analysis by my friend Dave Fraser, I thought ğŸ’­:\ncool analysis!\ncitizen science + eBird is awesome!\nhave I seen a Rufous Hummingbird ğŸ¦ lately?\nand then I thought â€¦\nmaybe you could do that analysis in R? ğŸ’¡\nAnd it turns out you can.\nGetting the eBird Data\nYou can get up-to-date eBird data via the eBird websiteâ€™s View & Explore options, but I was hoping to include more historical data and didnâ€™t want to click that often. The full eBird data set is available for download, but it is updated quarterlyâ€”so will not have the very recent observation records we are after. Sigh ğŸ˜.\nThen I talked to Andy Teucher about my eBird data woes. He introduced me to the rOpenSci R package ğŸ“¦ rebirdâ€”he is one of the package coauthors! ğŸ‘\nThe rebird package ğŸ“¦ provides an interface with the eBird webservicesâ€”which in regular english means it goes and gets the eBird data from the web. It also returns the data in a tidy format, meaning the data are ready to work with the popular tidyverse R packages ğŸ“¦ that many of us new to R have used to ease our way into coding.\nOK, so letâ€™s start by pulling A LOT of eBird dataâ€”50 years seems like a lot?\n#load R packages we will need for getting the data\nlibrary(rebird) #get eBird data from the web using ebirdfreq()\nlibrary(dplyr) #data munging\nlibrary(purrr) #map() for looping\n\n#thanks Andy for the purrr help!\n#function to get eBird data for many states/provinces using rebird R package\nmap_state <-  function(state) {\n  map_dfr(1968:2018, ~ {\n    ebirdfreq(\"states\", state, .x, .x, 1, 5) %>%\n      filter(comName == \"Rufous Hummingbird\") %>%\n      mutate(year = .x, state = state)\n  })\n}\n\n#get eBird data for west coast state/provinces\nruhu_raw <- map_dfr(c(\"CA-BC\",\"US-CA\",\"US-WA\", \"US-OR\"), ~ {\n      map_state(.x)\n})\n\nhead(ruhu_raw)\n## # A tibble: 6 x 6\n##   comName            monthQt    frequency sampleSize  year state\n##   <chr>              <chr>          <dbl>      <dbl> <int> <chr>\n## 1 Rufous Hummingbird January-1         0.        14.  1968 CA-BC\n## 2 Rufous Hummingbird January-2         0.         9.  1968 CA-BC\n## 3 Rufous Hummingbird January-3         0.        11.  1968 CA-BC\n## 4 Rufous Hummingbird January-4         0.        14.  1968 CA-BC\n## 5 Rufous Hummingbird February-1        0.        15.  1968 CA-BC\n## 6 Rufous Hummingbird February-2        0.        14.  1968 CA-BC\nThe eBird data provided by rebird is indeed very tidy. ğŸ Letâ€™s take a moment to cheers the authors of and contributers to this open source R package. ğŸ‰\nSome Data Wrangling\nThere is still a bit of data cleaning or wrangling to doâ€”there alway is and it would be less fun if there wasnâ€™t ğŸ˜‰. We need to do something with the monthQt variable. This is our time variable, which we need for plotting. Right now it is coded as a character variable and it needs to be recognized as a date. And you might notice some zeros in the 2018 weeks that we have not yet livedâ€”or birded. Letâ€™s filter out those zeros, they should really have been NAs?\n#we need a few more packages\nlibrary(stringr) #clean up variables\nlibrary(lubridate) #make date data dates\nlibrary(tidyr) #separate month and quarter\n\nruhu_clean <- ruhu_raw %>% \n  separate(monthQt, c(\"month\", \"week\"), sep = \"-\") %>%\n  mutate(day = case_when(\n    week == 1 ~ 1,\n    week == 2 ~ 8,\n    week == 3 ~ 15,\n    week == 4 ~ 23\n  )) %>%\n  mutate(date = ymd(paste0(year, \"-\",month,\"-\",day))) %>% \n  mutate(week = lubridate::week(date)) %>% \n  filter(sampleSize != 0) #filter out any zero that is actually an NA\n\nhead(ruhu_clean)\n## # A tibble: 6 x 9\n##   comName    month  week frequency sampleSize  year state   day date      \n##   <chr>      <chr> <dbl>     <dbl>      <dbl> <int> <chr> <dbl> <date>    \n## 1 Rufous Huâ€¦ Januâ€¦    1.        0.        14.  1968 CA-BC    1. 1968-01-01\n## 2 Rufous Huâ€¦ Januâ€¦    2.        0.         9.  1968 CA-BC    8. 1968-01-08\n## 3 Rufous Huâ€¦ Januâ€¦    3.        0.        11.  1968 CA-BC   15. 1968-01-15\n## 4 Rufous Huâ€¦ Januâ€¦    4.        0.        14.  1968 CA-BC   23. 1968-01-23\n## 5 Rufous Huâ€¦ Febrâ€¦    5.        0.        15.  1968 CA-BC    1. 1968-02-01\n## 6 Rufous Huâ€¦ Febrâ€¦    6.        0.        14.  1968 CA-BC    8. 1968-02-08\nThat looks ğŸ‘€ better!\nSome Exploratory Data Visualizing\nNow letâ€™s have a quick, exploratory look ğŸ‘€ at what data we have, starting just with British Columbia.\n#we need another package\nlibrary(ggplot2) #plotting\n\nruhu_clean %>% \n  filter(state == \"CA-BC\") %>%  #just B.C.\n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(colour = \"grey\") +\n  theme_minimal()\n\nThere seems to be a lot of very high frequency values in the data set (frequency = 1.0), which is a bit puzzlingâ€”all the birds observed were Rufous Hummingbirds â“. Letâ€™s colour the lines for each yearâ€”using a continuous colour scaleâ€”to see if we learn something.\nruhu_clean %>% \n  filter(state == \"CA-BC\") %>%  #just B.C.\n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = year)) +\n  theme_minimal()\n\nHmmmmmâ€¦this shows that most of that puzzling data is pre-2000s. eBird launched in 2002, with birders able to enter observations instantly via smartphones. Andyâ€”a birder and contributor to eBirdâ€”mentioned that maybe the older records are being entered by birders going through past checklists & field notebooks. Filtering out the pre-2002 data seems like a reasonable approach?\nruhu_since_2002 <- ruhu_clean %>% \n  filter(year > 2001) \n\nruhu_since_2002 %>% \n  filter(state == \"CA-BC\") %>%  #just B.C.\n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = year)) +\n  theme_minimal()\n\nLooks ğŸ‘€ better!\nHow Do 2018 ğŸ¦ Observation Frequencies Compare with Historical Data?\nLetâ€™s use some colour to distinguish the 2018 data from the 2002-2017 observation frequencies.\n#make a small df with just 2018 data\ndf_bc_2018 <- ruhu_since_2002 %>% \n  filter(state == \"CA-BC\", year == 2018) \n\nruhu_since_2002 %>% \n  filter(state == \"CA-BC\") %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_bc_2018, aes(colour = \"red\")) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"red\")) +\n  theme_minimal()\n\nThis plot confirms the original analysis with the first 2018 Rufous Hummingbird observations later than most years since 2002. However, the rate of increase in observation frequency seems to be similar.\nLetâ€™s look at all the Pacific Coast data now?\n#make a small df with just 2018 data\ndf_2018 <- ruhu_since_2002 %>% \n  filter(year == 2018) \n\nruhu_since_2002 %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_2018, aes(colour = \"red\")) +\n  facet_wrap(~ state, ncol=1) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"red\")) +\n  theme_minimal()\n\nInteresting! But wait, while Iâ€™d like California to be a bit closer to British Columbia, I think I want the order of my facet plots to mirror the order along the Pacific Coast. Letâ€™s make sure the variable state is a factor and in the order we want for plotting.\n#we need another package\nlibrary(forcats) #for wrangling factors\n\n#order for facet plotting\nwc_order <- c(\"CA-BC\",\"US-WA\",\"US-OR\",\"US-CA\")\n\n#make state a factor and order for facet plotting\nruhu_since_2002 <- ruhu_since_2002 %>% \n  mutate(state = factor(state, levels = wc_order))\n\n#make a small df with just 2018 data\ndf_2018 <- ruhu_since_2002 %>% \n  filter(year == 2018) \n\nruhu_since_2002 %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_2018, aes(colour = \"red\")) +\n  facet_wrap(~ state, ncol=1) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"red\")) +\n  theme_minimal()\n\nLooks ğŸ‘€ better!\nAnd again, the plot confirms the original analysisâ€”first observations are later and frequencies are lower for Rufous Hummingbirds, especially in Oregon, Washington and British Columbia.\nLetâ€™s finish up with some window dressing for our plots, adding the usual suspects like a title and data attribution, and adding a nice silhouette of a hummingbird using the rphylopic R package ğŸ“¦. Andy even suggested using the rufous colourâ€”ğŸ’¯.\nSo final plot for British Columbia:\n#we need a couple more packages\nlibrary(rphylopic) #for image, package from GitHub\nlibrary(curl) #required by rphylopic function\n\n## add image\nhummer <- image_data(\"679605a3-95f1-4f57-be33-568640aca7b9\", size = \"512\")[[1]]\n\n#make a small df with just 2018 data\ndf_bc_2018 <- ruhu_since_2002 %>% \n  filter(state == \"CA-BC\", year == 2018) \n\nruhu_since_2002 %>% \n  filter(state == \"CA-BC\") %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_bc_2018, aes(colour = \"orange3\")) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"orange3\")) +\n  labs(title = \"Frequency of Rufous Hummingbird Observations\\nin British Columbia (2002-2018)\",\n       caption = \"Data from eBird\") +\n  theme_minimal() +\n  theme(legend.position = c(0.15, 0.3)) +\n  add_phylopic(hummer, alpha = .7, color = \"orange3\", ysize = 7, x = 45, y = .3)\n\nand final plot for the Pacific Coast:\n#order for facet plotting\nwc_order <- c(\"CA-BC\",\"US-WA\",\"US-OR\",\"US-CA\")\n\n#make state a factor and order for facet plotting\nruhu_since_2002 <- ruhu_since_2002 %>% \n  mutate(state = factor(state, levels = wc_order))\n\n#make a small df with just 2018 data\ndf_2018 <- ruhu_since_2002 %>% \n  filter(year == 2018) \n\nruhu_since_2002 %>% \n  ggplot(aes(x = week, y = frequency, group = year)) +\n  geom_line(aes(colour = \"grey\"),  alpha = .5) +\n  geom_line(data = df_2018, aes(colour = \"orange3\")) +\n  facet_wrap(~ state, ncol=1) +\n  scale_colour_manual(name=NULL,\n                      labels=c(\"2002-2017\", \"2018\"),\n                      values=c(\"grey\", \"orange3\")) +\n  labs(title = \"Frequency of Rufous Hummingbird Observations\\nAlong the Pacific Coast (2002-2018)\",\n       caption = \"Data from eBird\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\") +\n  add_phylopic(hummer, alpha = .7, color = \"orange3\", ysize = 3, x = 45, y = .3)\n\nOK, I know. The silhouette is not a Rufous Hummingbird. It is a Topazza pellaâ€”the Crimson Topazâ€”the only hummingbird image in the phylopic library. At least it is a hummingbird?\nFor more on Rufous Hummingbirds (Selasphorus rufus), you can read the species account in the The Birds of North America series.\nFor keeping up with cool nature stuff in Victoria, British Columbia, you can follow the Victoria Natural History Society twitter feed.\nIf you see ğŸ‘€ a Rufous Hummingbird, you can add your observation to eBird.\n\nADDENDUM: AUK & a better hummingbird image\n\nIf you want to wrangle the full eBird data set, you might want to check out the R package ğŸ“¦ AUK, also recently onboarded at rOpenSci.\nAnd thanks to the above tweet from phylopic, we have a final, final set of plots with an improved hummingbird image ğŸ˜„.\n\n\n\nThis exploration was a collaboration with Andy Teucherâ€”Andy told me about rebird ğŸ“¦, provided help with loops using the purrr ğŸ“¦, along with many other gReat suggestions. This post was originally published through GitHub.\n\n\n\n",
    "preview": {},
    "last_modified": "2020-09-26T20:21:43-07:00",
    "input_file": {}
  }
]
